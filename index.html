<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <title>Cijfer Pop Spel</title>
  <style>
    :root{
      /* startkleur, wordt per level vervangen door een pastel uit JS */
      --bg1: #f3f1ff;
      --bg2: #eaf7ff;
      --fg: #0b1020;

      /* bubbel glans, je ziet grotere, zachte bollen */
      --bubble-hl: #ffffff;
      --bubble-mid: #e6faff;
      --bubble-lo: #ccefff;
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color: rgba(0,0,0,0) }
    html, body{
      margin:0;
      height:100%;
      background: #fff;
      color: var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      overscroll-behavior: none;
      touch-action: none;
    }
    #app{
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      overflow:hidden;
      background: radial-gradient(120% 120% at 70% 20%, var(--bg1) 0%, var(--bg2) 60%, #ffffff 100%);
      transition: background .6s ease;
    }

    /* bovenste balk, eenvoudig en rustig */
    .ui{
      position:absolute;
      left:0;
      right:0;
      top: env(safe-area-inset-top, 0px);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 12px 16px;
      pointer-events:none;
    }
    .badge{
      pointer-events:auto;
      padding: 8px 12px;
      border-radius: 9999px;
      background: rgba(0,0,0,.06);
      backdrop-filter: blur(6px);
      font-weight: 800;
      font-size: 14px;
      letter-spacing: .2px;
    }
    .controls{ display:flex; gap:8px; pointer-events:auto }
    button{
      border:0;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 900;
      font-size: 14px;
      color: #0b1020;
      background: rgba(0,0,0,.08);
      border: 1px solid rgba(0,0,0,.06);
      cursor:pointer;
    }

    /* overlay voor start, nodig voor audio, werkt op iOS */
    #startOverlay{
      position:absolute;
      inset:0;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:18px;
      padding: 24px;
      background: linear-gradient(180deg, rgba(255,255,255,.4), rgba(255,255,255,.7));
      backdrop-filter: blur(4px);
      text-align:center;
    }
    #startOverlay.hidden{ display:none }
    #startOverlay .title{ font-size: clamp(22px, 3.8vmin, 30px); font-weight: 1000 }
    #startOverlay .hint{ font-size: clamp(14px, 2.2vmin, 18px); opacity:.9 }

    /* bubbel basis, maat wordt per bubbel gezet in JS */
    .bubble{
      position:absolute;
      display:grid;
      place-items:center;
      border-radius: 9999px;
      font-weight: 1000;
      font-size: clamp(26px, 4.6vmin, 42px);
      color: #0b1020;
      background: radial-gradient(140% 140% at 30% 25%, var(--bubble-hl) 0%, var(--bubble-mid) 40%, var(--bubble-lo) 100%);
      border: 2px solid rgba(255,255,255,.9);
      box-shadow:
        inset 0 1px 1px rgba(255,255,255,.8),
        inset 0 -10px 18px rgba(0,0,0,.08),
        0 10px 24px rgba(0,0,0,.12);
      transform: translate3d(0,0,0) scale(1);
      will-change: transform;
      user-select:none; -webkit-user-select:none;
      transition: transform .18s ease;
    }
    .bubble::after{
      content:"";
      position:absolute;
      top: 12%;
      left: 18%;
      width: 28%;
      height: 22%;
      border-radius: 9999px;
      background: rgba(255,255,255,.65);
      filter: blur(1px);
      transform: rotate(12deg);
      pointer-events:none;
    }

    /* speels poppen: korte bounce, draai, ring en confetti */
    .pop{
      animation: pop .35s cubic-bezier(.2, .8, .2, 1) forwards;
    }
    @keyframes pop{
      0%{ transform: var(--t) scale(1) rotate(0deg); opacity:1 }
      45%{ transform: var(--t) scale(1.22) rotate(6deg); opacity:1 }
      100%{ transform: var(--t) scale(.4) rotate(-12deg); opacity:0 }
    }
    .ring{
      position:absolute;
      pointer-events:none;
      border-radius: 9999px;
      border: 3px solid rgba(0,0,0,.12);
      transform: translate(-50%, -50%) scale(0.6);
      opacity: .9;
      animation: ring .45s ease-out forwards;
    }
    @keyframes ring{
      to{ transform: translate(-50%, -50%) scale(1.4); opacity:0 }
    }
    .dot{
      position:absolute;
      width: 10px;
      height: 10px;
      border-radius:9999px;
      opacity: .95;
      transform: translate(-50%, -50%) scale(1);
      animation: dot .5s ease-out forwards;
    }
    @keyframes dot{
      to{ transform: translate(var(--dx), var(--dy)) scale(.8); opacity:0 }
    }

    /* korte hint onderin */
    #toast{
      position:absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: calc(16px + env(safe-area-inset-bottom, 0px));
      padding: 10px 14px;
      background: rgba(0,0,0,.08);
      border: 1px solid rgba(0,0,0,.06);
      color: var(--fg);
      border-radius: 12px;
      font-weight: 800;
      font-size: 14px;
      opacity: 0;
      transition: opacity .25s ease;
      pointer-events:none;
    }
    #toast.show{ opacity: 1 }
  </style>
</head>
<body>
  <div id="app" aria-label="Cijfer Pop Spel" role="application">
    <div class="ui">
      <div class="badge" id="badge">Tik het getal dat je ziet</div>
      <div class="controls">
        <button id="speakBtn" type="button" aria-label="Lees de opdracht">Lees voor</button>
        <button id="resetBtn" type="button" aria-label="Opnieuw">Opnieuw</button>
      </div>
    </div>

    <div id="startOverlay" aria-modal="true" role="dialog">
      <div class="title">Klaar voor het spel</div>
      <div class="hint">Tik op Start, je ziet eerst alleen 1, daarna komen er steeds meer</div>
      <button id="startBtn" type="button">Start</button>
    </div>

    <div id="toast" role="status" aria-live="polite"></div>
  </div>

  <script>
  ;(() => {
    const app = document.getElementById('app')
    const startOverlay = document.getElementById('startOverlay')
    const startBtn = document.getElementById('startBtn')
    const speakBtn = document.getElementById('speakBtn')
    const resetBtn = document.getElementById('resetBtn')
    const toast = document.getElementById('toast')
    const badge = document.getElementById('badge')

    // Pasteltinten, per level wisselen
    const PASTELS = [
      ['#fde2e4', '#fff1f1'], // zacht roze
      ['#dfe7fd', '#eef3ff'], // licht blauw
      ['#e4f1e1', '#f2faef'], // mint
      ['#fff4cc', '#fff9e6'], // zacht geel
      ['#f3e8ff', '#f9f2ff'], // lila
      ['#eaf7ff', '#f5fbff'], // ijsblauw
      ['#ffe9f2', '#fff3f8'], // bloesem
      ['#e9fff5', '#f3fffa'], // mintgroen
      ['#fff0e6', '#fff7f2'], // perzik
      ['#eef7ff', '#f6fbff']  // porselein
    ]

    // Nederlandse telwoorden
    const NUM_WORDS_NL = {
      0:'nul',1:'één',2:'twee',3:'drie',4:'vier',5:'vijf',6:'zes',7:'zeven',8:'acht',9:'negen',10:'tien',
      11:'elf',12:'twaalf',13:'dertien',14:'veertien',15:'vijftien',16:'zestien',17:'zeventien',18:'achttien',19:'negentien',20:'twintig'
    }

    const state = {
      moving: false,          // beweging aan of uit
      wave: 1,                // huidige level
      maxWave: 10,
      bubbles: [],
      velocities: [],
      runningRAF: 0,
      lastTime: 0,
      voice: null,
      minSpeed: 10,           // zachte beweging in px per seconde
      maxSpeed: 22,
      // bubbelmaten, voor kleuters lekker groot, maar toch variatie
      minSize: 88,            // px, wordt nog opgeschaald bij grote schermen
      maxSize: 160
    }

    // Pastelkleur toepassen
    function setPastelForWave(wave){
      const pair = PASTELS[(wave - 1) % PASTELS.length]
      document.documentElement.style.setProperty('--bg1', pair[0])
      document.documentElement.style.setProperty('--bg2', pair[1])
    }

    // Fullscreen
    async function enterFullscreen(){
      const el = document.documentElement
      try{
        if(el.requestFullscreen) await el.requestFullscreen()
        else if(el.webkitRequestFullscreen) await el.webkitRequestFullscreen()
      }catch(e){}
    }

    function resize(){
      app.style.width = innerWidth + 'px'
      app.style.height = innerHeight + 'px'
    }
    addEventListener('resize', resize, {passive:true})
    addEventListener('orientationchange', () => setTimeout(resize, 250))

    function rand(min, max){ return Math.random() * (max - min) + min }
    function showToast(msg){
      toast.textContent = msg
      toast.classList.add('show')
      clearTimeout(showToast._t)
      showToast._t = setTimeout(() => toast.classList.remove('show'), 1100)
    }

    // Spraak, voorkeur voor Nederlandse vrouwenstem
    function loadVoices(){
      return new Promise(resolve => {
        const now = speechSynthesis.getVoices()
        if(now.length) resolve(now)
        else speechSynthesis.onvoiceschanged = () => resolve(speechSynthesis.getVoices())
      })
    }
    function isFemaleName(name=''){
      // veelvoorkomende namen per platform, voorkeur voor vrouw
      return /(claire|saskia|ellen|lotte|femke|mila|maja|slt|female|woman)/i.test(name)
    }
    function isClearlyMale(name=''){
      return /(xander|willem|stephan|male|man)/i.test(name)
    }
    function pickDutchFemale(voices){
      const nl = voices.filter(v => v.lang && v.lang.toLowerCase().startsWith('nl'))
      const females = nl.filter(v => isFemaleName(v.name) && !isClearlyMale(v.name))
      if(females.length) return females[0]
      if(nl.length) return nl[0]
      // geen NL beschikbaar, neem een vrouwelijke klank op basis van naam
      const otherFem = voices.filter(v => isFemaleName(v.name))
      if(otherFem.length) return otherFem[0]
      return voices[0] || null
    }
    function numberWord(n){ return NUM_WORDS_NL[n] || String(n) }
    function speak(text, rate=1.02){
      try{
        speechSynthesis.cancel()
        const u = new SpeechSynthesisUtterance(text)
        u.lang = 'nl-NL'
        u.rate = rate
        if(state.voice) u.voice = state.voice
        speechSynthesis.speak(u)
      }catch(e){}
    }

    // Confetti en ring bij pop
    function burst(x, y, baseSize){
      // ring
      const ring = document.createElement('div')
      ring.className = 'ring'
      const r = Math.max(28, baseSize * 0.5)
      ring.style.width = r + 'px'
      ring.style.height = r + 'px'
      ring.style.left = x + 'px'
      ring.style.top = y + 'px'
      app.appendChild(ring)
      ring.addEventListener('animationend', () => ring.remove(), {once:true})

      // zachte confetti, drie puntjes in babykleuren
      const dots = 3
      const colors = ['#ffd6e7', '#e2f2ff', '#e6ffe8', '#fff3d6', '#f3e8ff']
      for(let i=0;i<dots;i++){
        const d = document.createElement('div')
        d.className = 'dot'
        d.style.left = x + 'px'
        d.style.top = y + 'px'
        d.style.background = colors[Math.floor(Math.random()*colors.length)]
        const dist = Math.max(24, baseSize * 0.35)
        const angle = rand(0, Math.PI*2)
        const dx = Math.cos(angle) * dist + 'px'
        const dy = Math.sin(angle) * dist + 'px'
        d.style.setProperty('--dx', dx)
        d.style.setProperty('--dy', dy)
        app.appendChild(d)
        d.addEventListener('animationend', () => d.remove(), {once:true})
      }
    }

    // Bubbels aanmaken voor ronde 1..wave
    function createWaveBubbles(){
      clearBubbles()
      const W = app.clientWidth
      const H = app.clientHeight
      const pad = 16

      for(let n=1; n<=state.wave; n++){
        const el = document.createElement('div')
        el.className = 'bubble'
        el.textContent = n
        el.dataset.num = n

        // willekeurige maat, groter voor kleuters
        const baseMin = Math.max(state.minSize, Math.min(innerWidth, innerHeight) * 0.12)
        const baseMax = Math.max(state.maxSize, Math.min(innerWidth, innerHeight) * 0.20)
        const size = Math.floor(rand(baseMin, baseMax))
        el.style.width = size + 'px'
        el.style.height = size + 'px'

        // z index zodat het laagste cijfer bovenop ligt
        el.style.zIndex = String(1000 - n)

        // tijdelijke meting is niet nodig, we kennen de maat
        let x = rand(pad, Math.max(pad, W - size))
        let y = rand(pad + 60, Math.max(pad + 60, H - size))
        let tries = 0
        while(overlapsExisting(x, y, size) && tries < 200){
          x = rand(pad, Math.max(pad, W - size))
          y = rand(pad + 60, Math.max(pad + 60, H - size))
          tries++
        }

        el.style.setProperty('--t', `translate3d(${x}px, ${y}px, 0)`)
        el.style.transform = `translate3d(${x}px, ${y}px, 0)`
        el.dataset.x = x
        el.dataset.y = y
        el.dataset.size = size

        el.addEventListener('pointerdown', onBubbleTap, {passive:true})

        // snelheid voor beweging
        const sp = rand(state.minSpeed, state.maxSpeed)
        const angle = rand(0, Math.PI * 2)
        const v = { vx: Math.cos(angle)*sp, vy: Math.sin(angle)*sp }

        app.appendChild(el)
        state.bubbles.push(el)
        state.velocities.push(v)
      }

      enforceStacking()
    }

    function overlapsExisting(x, y, size){
      for(const b of state.bubbles){
        const bx = parseFloat(b.dataset.x)
        const by = parseFloat(b.dataset.y)
        const bs = parseFloat(b.dataset.size)
        const dx = (bx + bs*.5) - (x + size*.5)
        const dy = (by + bs*.5) - (y + size*.5)
        const rr = (bs*.5 + size*.5)
        if(dx*dx + dy*dy < rr*rr * 0.92) return true
      }
      return false
    }

    function clearBubbles(){
      for(const b of state.bubbles){
        b.removeEventListener('pointerdown', onBubbleTap)
        b.remove()
      }
      state.bubbles = []
      state.velocities = []
    }

    // Klik op bubbel
    function onBubbleTap(e){
      const el = e.currentTarget
      const n = parseInt(el.dataset.num, 10)
      if(!state.bubbles.includes(el)) return

      // spreek cijfernaam met voorkeur voor vrouwenstem
      speak(numberWord(n))

      // pop animatie en speelse effecten
      const rect = el.getBoundingClientRect()
      const cx = rect.left + rect.width/2
      const cy = rect.top + rect.height/2
      burst(cx, cy, parseFloat(el.dataset.size))

      el.classList.add('pop')
      el.addEventListener('animationend', () => {
        const idx = state.bubbles.indexOf(el)
        if(idx >= 0){
          state.bubbles.splice(idx, 1)
          state.velocities.splice(idx, 1)
        }
        el.remove()
        if(state.bubbles.length === 0){
          nextWave()
        }else{
          enforceStacking()
        }
      }, {once:true})
    }

    // laagste cijfer bovenop
    function enforceStacking(){
      let minN = Infinity
      for(const b of state.bubbles){
        const n = parseInt(b.dataset.num, 10)
        if(n < minN) minN = n
      }
      for(const b of state.bubbles){
        const n = parseInt(b.dataset.num, 10)
        b.style.zIndex = String(1000 - n)
      }
      const minB = state.bubbles.find(b => parseInt(b.dataset.num,10) === minN)
      if(minB){
        const x = parseFloat(minB.dataset.x), y = parseFloat(minB.dataset.y)
        minB.style.transform = `translate3d(${x}px, ${y}px, 1px)`
        setTimeout(() => { minB.style.transform = `translate3d(${x}px, ${y}px, 0)` }, 0)
      }
    }

    // Volgende level
    function nextWave(){
      // pastel wissel
      setPastelForWave(state.wave + 1)

      // verhoog, reset na max
      state.wave = state.wave + 1
      if(state.wave > state.maxWave){
        state.wave = 1
        showToast('We beginnen opnieuw bij 1')
        speak('We beginnen opnieuw bij één', 1.0)
      }else{
        showToast(`Nu tot en met ${state.wave}`)
        speak(`Nu tot en met ${numberWord(state.wave)}`, 1.0)
      }

      // vanaf level 2 bewegen de cijfers langzaam
      state.moving = state.wave >= 2

      createWaveBubbles()
      badge.textContent = `Tik de cijfers weg tot en met ${state.wave}`
    }

    // Animatie loop
    function tick(ts){
      if(!state.moving){ state.lastTime = ts; state.runningRAF = requestAnimationFrame(tick); return }
      if(!state.lastTime) state.lastTime = ts
      const dt = Math.min(0.05, (ts - state.lastTime) / 1000)
      state.lastTime = ts

      const W = app.clientWidth
      const H = app.clientHeight

      for(let i=0;i<state.bubbles.length;i++){
        const el = state.bubbles[i]
        const v = state.velocities[i]
        let x = parseFloat(el.dataset.x)
        let y = parseFloat(el.dataset.y)
        const s = parseFloat(el.dataset.size)

        x += v.vx * dt
        y += v.vy * dt

        // randen, zacht kaatsen
        if(x <= 0){ x = 0; v.vx = Math.abs(v.vx) }
        if(y <= 0){ y = 0; v.vy = Math.abs(v.vy) }
        if(x + s >= W){ x = W - s; v.vx = -Math.abs(v.vx) }
        if(y + s >= H){ y = H - s; v.vy = -Math.abs(v.vy) }

        el.dataset.x = x
        el.dataset.y = y
        el.style.setProperty('--t', `translate3d(${x}px, ${y}px, 0)`)
        el.style.transform = `translate3d(${x}px, ${y}px, 0)`
      }

      // stapeling af en toe herbevestigen
      if(Math.floor(performance.now()/1000)%2===0){
        enforceStacking()
      }

      state.runningRAF = requestAnimationFrame(tick)
    }

    // Start, Reset
    async function start(){
      await enterFullscreen()
      resize()
      const voices = await loadVoices()
      state.voice = pickDutchFemale(voices)

      // start bij 1, stilstaand, alleen 1 zichtbaar
      state.wave = 1
      state.moving = false
      setPastelForWave(1)
      clearBubbles()
      createWaveBubbles()
      badge.textContent = 'Tik het getal dat je ziet'
      startOverlay.classList.add('hidden')
      showToast('Tik 1')
      speak('Tik één', 1.02)

      cancelAnimationFrame(state.runningRAF)
      state.lastTime = 0
      state.runningRAF = requestAnimationFrame(tick)
    }

    function reset(){
      start()
    }

    // UI events
    startBtn.addEventListener('click', start)
    resetBtn.addEventListener('click', reset)
    speakBtn.addEventListener('click', () => {
      if(state.bubbles.length === 1 && state.wave === 1){
        speak('Tik één', 1.02)
        showToast('Tik 1')
      }else{
        speak(`Tik de cijfers weg tot en met ${numberWord(state.wave)}`, 1.02)
      }
    })

    // Eerste layout en voorkom rubberband scroll op iOS
    resize()
    document.addEventListener('touchmove', e => e.preventDefault(), {passive:false})
  })()
  </script>
</body>
</html>
